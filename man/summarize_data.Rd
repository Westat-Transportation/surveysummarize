% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/summarize_data.R
\name{summarize_data}
\alias{summarize_data}
\title{Summarize HTS Data}
\usage{
summarize_data(data, agg, agg_var = NULL, by = NULL, subset = NULL,
  prop = FALSE, prop_by = NULL, exclude_missing = FALSE,
  use_labels = TRUE)
}
\arguments{
\item{data}{Object returned by \link[surveysummarize]{read_data}.}

\item{agg}{Aggregate function label. Either "household_count", "person_count", "trip_count",
"sum", "avg", "median", "household_trip_rate", or "person_trip_rate". See \emph{Aggregates} section}

\item{agg_var}{Character string specifying a numeric variable over which to aggregate.
Only relavent when agg is "sum", "avg", or "median"}

\item{by}{Character vector of one or more variable names to group by. See \emph{Analysis Groups} section.}

\item{subset}{Character string containing a pre-aggregation subset condition using \link[data.table]{data.table} syntax.
See \emph{Filter} section.}

\item{prop}{logical. Use proportions for count aggregates?}

\item{prop_by}{Character vector of one or more variable names by which to group proportions.}

\item{exclude_missing}{logical. Exclude missing responses from summary.}

\item{label}{logical. Use labels for table output?}
}
\value{
data.table object aggregated by input specifications containing the following fields:

\itemize{
  \item \code{by} variables. For each \code{by} variable, a column of the same name is created.
  They will appear in the order they are listed as \link[base]{factor}s ordered by their codebook values.
  \item \strong{Estimate} - Weighted statistic.
  \item \strong{SE} - Standard error of the weighted statistic.
  \item \strong{Survey} - Surveyed/sampled statistic.
  \item \strong{N} - Number of observations/sample size.
}
}
\description{
Create weighted aggregate tables using HTS data.
}
\section{Aggregates (\code{agg})}{

What type of aggregate are you interested in?

\subsection{Frequencies / Proportions}{
  \itemize{
    \item \strong{household_count} - Count of households
    \item \strong{person_count} - Count of persons
    \item \strong{trip_count} - Count of trips
    \item \strong{vehicle_count} - Count of vehicles
  }
  \emph{*Use} \code{prop = TRUE} \emph{in combination with a count aggregate to get the proportion.}
}

\subsection{Numeric Aggregates (Sum / Average / Median)}{
  \emph{Must also specify a numeric aggregate variable using the} \code{agg_var} \emph{parameter.}
  \itemize{
    \item \strong{sum} - Sum of \code{agg_var}
    \item \strong{avg} - Arithmetic mean of \code{agg_var}
    \item \strong{median} - Median of \code{agg_var}
  }
}

\subsection{Trip Rates (Daily Person Trips per Person/Household)}{
  Simply put, the count of trips divided by the count of persons or households.
  \itemize{
    \item \strong{household_trip_rate} - Daily trips per household.
    \item \strong{person_trip_rate} - Daily trips per person.
  }
}
}

\section{Analysis Groups (\code{by})}{

By which variables to you wish to aggregate?

Similar to \code{GROUP BY} in SQL or a \code{CLASS} statement in SAS.
There is no limit to the number of variables specified in the character vector, however many \code{by} variables
can result in groups with small sample sizes which need to be interpreted carefully.

The data.table returned by summarize_data will include a column (of class \link[base]{factor}) for each \code{by} variable specified.
}

\section{Filtering (\code{subset})}{

Which households/person/trips do you wish to include or exclude?

Similar to \code{WHERE} in SQL, \code{subset} allows you to filter observations/rows in the dataset before summarizing/aggregating.

\code{subset} is a string that will be evaluated as a logical vector indicating the rows to keep.
As mentioned above, the string will be evaluated as the \code{i} index in a \link[data.table]{data.table}.
In short, similar to the base function \link[base]{subset},
there is no need to specify the data object in which the variables are included
(i.e.: your code would look like \code{"var < 10"} instead of \code{"data$var < 10"}).

Any variable (or combination of variables) found in the codebook can be used in the subset condition.
See \link[base]{Logic} for a refresher on R's logical operators when using more than one logical condition.

\subsection{Quoting within quotes}{
You will frequently need to include quotes in your string. You can tackle this a few different ways.
The following examples would all evaluate the same way:
  \itemize{
    \item \code{"HHSTATE \%in\% c('GA','FL')"}
    \item \code{'HHSTATE \%in\% c("GA","FL")'}
    \item \code{"HHSTATE \%in\% c(\"GA\",\"FL\")"}
  }
}
}

\examples{
\donttest{
# Read the data
hts_data <- read_data(
  study = 'nirpc_2018',
  project_path = 'C:/2018 NIRPC Household Travel Survey'
)

summarize_data(
  data = hts_data,             # Using the hts_data object,
  agg = 'person_trip_rate',    # calculate the person trip rate
  by = 'sex',                  # by gender
  subset = 'emply_ask == "1"'  # for workers
)
}


}
